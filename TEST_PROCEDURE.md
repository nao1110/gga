# CareerTre (キャリトレ) 動作確認テスト手順書

作成日: 2025年11月8日

## 📋 事前準備

### 1. XAMPPの起動確認
- [ ] XAMPP Control Panelを開く
- [ ] Apache が起動している（緑色）
- [ ] MySQL が起動している（緑色）

### 2. データベースの確認
ブラウザで以下にアクセス:
```
http://localhost/phpmyadmin
```
- [ ] `careertre_db` データベースが存在する
- [ ] `users`, `trainers`, `reserves`, `feedbacks` テーブルが存在する

---

## 🧪 テスト1: ユーザー（受験生）新規登録

### URL
```
http://localhost/gs_code/gga/page/user/register.php
```

### テストケース 1-1: 正常登録
**入力値:**
- 名前: `テスト受験者`
- メールアドレス: `test-user@example.com`
- パスワード: `password123`
- パスワード（確認）: `password123`

**期待される結果:**
- ✅ ログインページにリダイレクト
- ✅ 「登録が完了しました」メッセージが表示される
- ✅ データベースの`users`テーブルに新規レコードが追加される
- ✅ `ticket_count`が5に設定されている

### テストケース 1-2: バリデーションエラー
**入力値:**
- 名前: (空欄)
- メールアドレス: `invalid-email`
- パスワード: `123` (短すぎる)

**期待される結果:**
- ✅ エラーメッセージが表示される
- ✅ データベースに登録されない

---

## 🧪 テスト2: トレーナー（キャリアコンサルタント）新規登録

### URL
```
http://localhost/gs_code/gga/page/trainer/register.php
```

### テストケース 2-1: 正常登録
**入力値:**
- 名前: `テストキャリアコンサルタント`
- メールアドレス: `test-trainer@example.com`
- パスワード: `trainer123`
- パスワード（確認）: `trainer123`

**期待される結果:**
- ✅ ログインページにリダイレクト
- ✅ 「登録が完了しました」メッセージが表示される
- ✅ データベースの`trainers`テーブルに新規レコードが追加される
- ✅ `specialty`列がないことでエラーが出ない

---

## 🧪 テスト3: ユーザーログインとマイページ表示

### URL
```
http://localhost/gs_code/gga/page/user/login.php
```

### テストケース 3-1: ログイン
**入力値:**
- メールアドレス: `test-user@example.com`
- パスワード: `password123`

**期待される結果:**
- ✅ マイページ(`/page/user/mypage.php`)にリダイレクト
- ✅ 「ようこそ、テスト受験者 さん」と表示される
- ✅ 進捗状況: `0 / 5 回完了` と表示される
- ✅ 5つのチェックポイントが表示される（すべて未完了）
- ✅ 「次の練習を予約リクエストをする」ボタンが表示される

---

## 🧪 テスト4: 予約作成（3ステップフォーム）

### URL
マイページから「次の練習を予約リクエストをする」ボタンをクリック
```
http://localhost/gs_code/gga/page/user/mypage/reserve/new.php
```

### テストケース 4-1: 日付選択
**操作:**
1. カレンダーから未来の日付を選択（例: 11月15日）

**期待される結果:**
- ✅ 選択した日付がハイライトされる
- ✅ 「次へ：時間を選択」ボタンが有効になる

### テストケース 4-2: 時間選択
**操作:**
1. 時間スロットから時間を選択（例: 14:00）

**期待される結果:**
- ✅ 選択した時間がハイライトされる
- ✅ 「次へ：確認」ボタンが有効になる

### テストケース 4-3: 確認画面
**操作:**
1. 確認画面で日付と時間が正しく表示されているか確認
2. 「予約を確定する」ボタンをクリック

**期待される結果:**
- ✅ 日付: `2025年11月15日（金）`のように表示される
- ✅ 時間: `14:00 - 15:00` のように表示される（1時間後の終了時刻も）
- ✅ マイページにリダイレクト
- ✅ 「予約リクエストを送信しました」メッセージが表示される

### テストケース 4-4: データベース確認
**確認項目:**
- ✅ `reserves`テーブルに新規レコードが追加される
- ✅ `trainer_id` が NULL
- ✅ `persona_id` が NULL
- ✅ `status` が 'pending'
- ✅ `meeting_date` が選択した日時になっている

---

## 🧪 テスト5: トレーナーログインと承認待ち予約の表示

### URL
```
http://localhost/gs_code/gga/page/trainer/login.php
```

### テストケース 5-1: ログイン
**入力値:**
- メールアドレス: `test-trainer@example.com`
- パスワード: `trainer123`

**期待される結果:**
- ✅ トレーナーマイページ(`/page/trainer/mypage.php`)にリダイレクト
- ✅ 「実技練習予約の承認」セクションが表示される
- ✅ 受験者名: `テスト受験者 さん`
- ✅ 日付: `2025年11月15日（金）`
- ✅ 時間: `14:00 - 15:00`
- ✅ 申請日が表示される
- ✅ 「承認」ボタンが表示される

---

## 🧪 テスト6: 予約承認処理

### テストケース 6-1: 予約を承認
**操作:**
1. 「承認」ボタンをクリック
2. 確認ダイアログで「OK」をクリック

**期待される結果:**
- ✅ 「予約を承認しました」メッセージが表示される
- ✅ 予約が「実技練習予約の承認」セクションから消える
- ✅ 「実施予定の実技練習」セクションに移動する

### テストケース 6-2: データベース確認
**確認項目:**
- ✅ `reserves`テーブルの該当レコードの`trainer_id`が設定される
- ✅ `status`が'confirmed'に変更される
- ✅ `updated_at`が更新される

---

## 🧪 テスト7: 確定済み予約の表示（トレーナー側）

### テストケース 7-1: 実施予定セクション確認
**確認項目:**
- ✅ 「実施予定の実技練習」セクションに予約が表示される
- ✅ 受験者名が表示される
- ✅ 日付が表示される（曜日付き）
- ✅ 時間が `14:00 - 15:00` 形式で表示される
- ✅ 「レポート入力」ボタンが表示される

---

## 🧪 テスト8: 確定済み予約の表示（ユーザー側）

### URL
再度ユーザーでログイン
```
http://localhost/gs_code/gga/page/user/login.php
```

### テストケース 8-1: マイページ確認
**確認項目:**
- ✅ 「予定されている練習（確定済み）」セクションに予約が表示される
- ✅ 日付、時間が正しく表示される
- ✅ キャリアコンサルタント名が表示される
- ✅ 「確定」バッジが表示される

---

## 🧪 テスト9: フィードバック入力（トレーナー側）

### URL
トレーナーマイページの「レポート入力」ボタンをクリック
```
http://localhost/gs_code/gga/page/trainer/mypage/reserve/feedback/input.php?id=XX
```

### テストケース 9-1: フィードバック入力
**入力値:**

**良かった点:**
1. `傾聴姿勢が非常に良好で、相手の話をしっかり受け止めている`
2. `うなずきやあいづちのタイミングが適切`
3. `クライアントが安心して話せる雰囲気を作れている`

**改善点:**
1. `質問の組み立てをもう少し整理すると良い`
2. `クライアントの本質的な課題に迫る深い質問を意識する`
3. `時間配分に注意（前半に時間を使いすぎている）`

**次回の目標:**
1. `キャリアの方向性を引き出す質問力の向上`
2. `具体的なアクションプランへの導き方`
3. `限られた時間での効果的な面談構成`

**総評:**
```
全体として良い面談ができていました。特に傾聴姿勢は素晴らしく、
クライアントも安心して話せる雰囲気を作れていました。
次回は質問の構成と時間配分を意識して練習してみましょう。
確実に成長しています！
```

**期待される結果:**
- ✅ 「フィードバックを提出しました」メッセージが表示される
- ✅ トレーナーマイページにリダイレクト
- ✅ 予約が「完了済み・レポート提出履歴」セクションに移動

### テストケース 9-2: データベース確認
**確認項目:**
- ✅ `feedbacks`テーブルに新規レコードが追加される
- ✅ `comment`列にJSON形式でデータが保存される
- ✅ `reserves`テーブルの`status`が'completed'に変更される

---

## 🧪 テスト10: フィードバック閲覧（ユーザー側）

### URL
再度ユーザーでログイン → マイページ
```
http://localhost/gs_code/gga/page/user/mypage.php
```

### テストケース 10-1: マイページでの表示確認
**確認項目:**
- ✅ 「過去の練習履歴・フィードバック」セクションに表示される
- ✅ 「レポート受領済み」バッジが表示される（緑色）
- ✅ 「フィードバックを見る」ボタンが表示される
- ✅ 進捗状況が `1 / 5 回完了` に更新される
- ✅ チェックポイントの1つ目が完了マーク（✓）になっている

### テストケース 10-2: フィードバック詳細ページ
**操作:**
1. 「フィードバックを見る」ボタンをクリック

**URL:**
```
http://localhost/gs_code/gga/page/user/mypage/reserve/feedback/view.php?id=XX
```

**確認項目:**
- ✅ 実施日時が表示される（開始〜終了時間）
- ✅ 担当キャリアコンサルタント名が表示される
- ✅ フィードバック提出日が表示される

**良かった点セクション（緑色）:**
- ✅ 入力した3つの項目が表示される
- ✅ ✓マーク付きで表示される

**改善点セクション（オレンジ色）:**
- ✅ 入力した3つの項目が表示される
- ✅ →マーク付きで表示される

**次回の目標セクション（青色）:**
- ✅ 入力した3つの項目が表示される
- ✅ 🎯マーク付きで表示される

**総評コメント（紫のグラデーション背景）:**
- ✅ 入力した総評が表示される
- ✅ 改行が保持されている

---

## 📊 最終確認チェックリスト

### データベースの状態確認
PhpMyAdmin で以下を確認:

```sql
-- ユーザー確認
SELECT * FROM users WHERE email = 'test-user@example.com';

-- トレーナー確認
SELECT * FROM trainers WHERE email = 'test-trainer@example.com';

-- 予約確認
SELECT 
    r.id, 
    r.meeting_date, 
    r.status, 
    r.trainer_id, 
    r.persona_id,
    u.name as user_name,
    t.name as trainer_name
FROM reserves r
LEFT JOIN users u ON r.user_id = u.id
LEFT JOIN trainers t ON r.trainer_id = t.id
ORDER BY r.created_at DESC
LIMIT 1;

-- フィードバック確認
SELECT * FROM feedbacks ORDER BY created_at DESC LIMIT 1;
```

### 期待されるデータ:
- ✅ `users`: 1件（test-user@example.com）
- ✅ `trainers`: 1件（test-trainer@example.com）
- ✅ `reserves`: 1件（status='completed', trainer_idが設定されている）
- ✅ `feedbacks`: 1件（JSON形式でフィードバックが保存されている）

---

## 🐛 トラブルシューティング

### エラーが出た場合の確認項目:

1. **Apache/MySQL が起動しているか**
   - XAMPP Control Panelで確認

2. **データベースが作成されているか**
   ```sql
   -- データベース一覧確認
   SHOW DATABASES;
   
   -- テーブル確認
   USE careertre_db;
   SHOW TABLES;
   ```

3. **PHPエラーログ確認**
   - XAMPPフォルダ内の `logs/php_error_log`
   - ブラウザのデベロッパーツール（F12）のコンソール

4. **セッションがクリアされているか**
   - 別のアカウントでログインする前にログアウトする
   - またはシークレットモード/プライベートブラウジングを使用

5. **タイムゾーンエラー**
   - Asia/Tokyo設定が正しく動作しているか
   - カレンダーで選択した日付が前日にならないか確認

---

## ✅ テスト完了の確認

全てのテストケースが成功した場合:
- ✅ ユーザー登録・ログイン機能が動作
- ✅ トレーナー登録・ログイン機能が動作
- ✅ 3ステップ予約フォームが動作
- ✅ 予約承認フローが動作
- ✅ フィードバック入力・保存が動作
- ✅ フィードバック閲覧が動作
- ✅ タイムゾーン（Asia/Tokyo）が正しく動作
- ✅ すべてのデータがDBに正しく保存されている

**🎉 おめでとうございます！すべての機能が正常に動作しています！**
